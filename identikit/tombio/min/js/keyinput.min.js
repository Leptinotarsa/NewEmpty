!function(t,e){"use strict";function a(){var a=t("input[name=charvisibility]:checked").val();t(".cloneInput .stateselect, .cloneInput .statespinner").each(function(r){if(void 0!==t(this).attr("id"))if("visible"==a)t(this).parents(".cloneInput").show(500,e.f.resizeControlsAndTaxa);else{var i=t(this).val();i&&""!=i?t(this).parents(".cloneInput").show(500,e.f.resizeControlsAndTaxa):t(this).parents(".cloneInput").hide(500,e.f.resizeControlsAndTaxa)}})}function r(r){var i=t("#"+r).pqSelect({multiplePlaceholder:"select option(s)",singlePlaceholder:"select option",checkbox:!0,search:!1,maxDisplay:20,width:240,selectallText:""});i.addClass("stateselect"),i.on("change",function(){if("clone-"==r.substring(0,6))var n=r.substring(6);else n="clone-"+r;if(t("#"+n).val(i.val()),t("#"+n).pqSelect("refreshData"),t("#"+r).pqSelect("refresh"),a(),"clone-"==r.substring(0,6))var s=r.substring(6);else s=r;var c=null!=i.val()&&""!=i.val();if(e.d.oCharacters[s].stateSet=c,c){if("string"==typeof i.val())var o=[i.val()];else o=i.val();var l=[];e.d.oCharacters[s].CharacterStateValues.forEach(function(t,e){o.indexOf(t)>-1&&l.push(e)}),e.d.oCharacters[s].userInput=l}else e.d.oCharacters[s].userInput=null;[r,n].forEach(function(a){var r=t("#"+a).next().children().find(".pq-select-item-text");r.attr("title",function(){var a=this,r=e.d.values.filter(function(e){if(e.Character==s&&e.CharacterState==t(a).text())return!0});return 1==r.length?r[0].StateHelpShort?r[0].StateHelpShort:r[0].StateHelp:""}),r.tooltip({track:!0})}),e.f.refreshVisualisation()}),i.val(t("#"+r+" option:first").val()).pqSelect("refreshData"),i.val("").pqSelect("refreshData")}function i(r,i,n,s){var c=t("#"+r).spinner({min:i,max:n,step:s});function o(i){i=c.spinner("value");if("clone-"==r.substring(0,6))var n=r.substring(6);else n="clone-"+r;if(t("#"+n).spinner("value",i),"clone-"==r.substring(0,6))var s=r.substring(6);else s=r;""==i||null===i?(e.d.oCharacters[s].stateSet=!1,e.d.oCharacters[s].userInput=null):(e.d.oCharacters[s].stateSet=!0,e.d.oCharacters[s].userInput=i),e.f.refreshVisualisation(),a()}c.addClass("statespinner"),c.on("spinstop",function(t,e){o()}),t("#"+r+"-clear").button({icon:"ui-icon-close",showLabel:!1}).on("click",function(){c.spinner("value",""),o()})}e.gui.keyInput={width:360,otherState:{keys:[]},bullet:"",verticalTabSpace:33},e.gui.keyInput.init=function(n){var s=this;t("<div>").attr("id","tombioKeyInputTabs").css("background-color","rgba( 255,255, 255, 0.7)").appendTo(n),t("<ul>").attr("id","tombioKeyInputListElements").appendTo("#tombioKeyInputTabs"),e.gui.keyInput.divSel="#tombioKeyInputTabs";var c={All:[]};for(var o in e.d.groupedCharacters.groups.forEach(function(t){c[t]=e.d.groupedCharacters[t]}),t(e.gui.main.divInput).css("min-height",this.verticalTabSpace*(e.d.groupedCharacters.groups.length+2)),c){var l="tombioKeyInputTab-"+o.replace(/\s+/g,"-"),p=t("<li/>"),u=t("<a/>").text(o).attr("href","#"+l);p.append(u),t("#tombioKeyInputListElements").append(p);var h=t("<div/>").attr("id",l);if(t("#tombioKeyInputTabs").append(h),"tombioKeyInputTab-All"==l){h.append(t("<div>").text("Un-used characters:").css("font-weight","bold"));var d=t("<fieldset>").attr("id","visCheckboxes").css("display","inline-block").css("padding","0px").css("border","none");d.append(t("<label>").attr("for","charvisible").text("show")),d.append(t("<input>").attr("type","radio").attr("name","charvisibility").attr("id","charvisible").attr("value","visible").attr("checked","checked")),d.append(t("<label>").attr("for","incharvisible").text("hide")),d.append(t("<input>").attr("type","radio").attr("name","charvisibility").attr("id","incharvisible").attr("value","invisible")),h.append(d),t("[name='charvisibility']").checkboxradio({icon:!1}),d.on("change",a);var f=t("<button>").attr("id","tombioReset").text("Reset all");f.button({icons:{primary:null,secondary:"ui-icon-reset"}}).click(function(r){t(".statespinner").spinner("value",""),t(".stateselect").each(function(){t(this).val()&&t(this).val("").pqSelect("refreshData")}),e.d.characters.forEach(function(t){t.stateSet=!1,t.userInput=null}),e.f.refreshVisualisation(),a()}),h.append(f)}for(var v=0;v<c[o].length;v++){var b=c[o][v],g=t("<span/>").attr("class","characterlabel").text(b.Label),y=t("<div/>").append(g);h.append(y),e.f.characterHasHelp(b.Character)&&(g.attr("character",b.Character),g.addClass("characterhelp"));var m=t("<div/>").attr("class","cloneInput");if(m.append(y.clone()),t("#tombioKeyInputTab-All").css("display","inline-block").append(m),"numeric"==b.ValueType){var C=b.Character,I=b.Params.split(","),S=Number(I[0]),k=Number(I[1]),x=Number(I[2]),T=t("<div>"),K=t("<input></input>").attr("class","spinner").attr("id",C),w=t("<div value='x'>").attr("class","widget").attr("class","spinclear").attr("id",C+"-clear");T.append(K),T.append(w),h.append(T),i(C,S,k,x);var E=t("<div>"),q=t("<input></input>").attr("class","spinner").attr("id","clone-"+C),D=t("<div value='x'>").attr("class","widget").attr("class","spinclear").attr("id","clone-"+C+"-clear");E.append(q),E.append(D),m.append(E),i("clone-"+C,S,k,x)}else{var A=b.Character;if("multi"==b.ControlType)var G=t("<select multiple=multiple></select>").attr("class","characterSelect");else G=t("<select></select>").attr("class","characterSelect");if(G.attr("id",A),h.append(G),"single"==b.ControlType){var V=t("<option/>").text("");G.append(V)}b.CharacterStateValues.forEach(function(e){var a=t("<option/>").text(s.bullet+e);G.append(a)}),r(A);var H=t("#"+A).clone();H.attr("id","clone-"+A),m.append(H),r("clone-"+A)}}}e.d.oCharacters.grouped||(t("#tombioKeyInputListElements").css("display","none"),t("#tombioKeyInputTabs").css("padding-left","0px"),e.gui.keyInput.width=255);var L,P=t("#tombioKeyInputTabs").tabs({activate:function(a,r){t(".stateselect").each(function(){}),e.f.resizeControlsAndTaxa()}});e.opts.toolconfig.genKeyinput||(e.opts.toolconfig.genKeyinput={});try{L=e.opts.toolconfig.genKeyinput.selectedGroup}catch(t){}if(!L)try{L=e.opts.toolconfig.keyinput.selectedGroup}catch(t){}if(!L)try{L=e.opts.selectedGroup}catch(t){}if(!L)try{L=e.d.kbconfig.defaultControlGroup}catch(t){}if(e.opts.toolconfig.genKeyinput.selectedGroup=L,e.opts.toolconfig.genKeyinput.selectedGroup){var F=e.d.groupedCharacters.groups.indexOf(e.opts.toolconfig.genKeyinput.selectedGroup);F>-1&&P.tabs("option","active",F+1)}t(".characterhelp").hover(function(){t(this).animate({color:"#D55E00"},"fast")},function(){t(this).animate({color:"black"},"fast")}).click(function(){var a,r;a=t(this).attr("character"),r=t("<div>"),t("<h3/>",{text:e.d.oCharacters[a].Label}).appendTo(r),r.append(t(e.f.getFullCharacterHelp(a))),e.gui.main.dialog("Character help & info",r.html())}),e.gui.main.createCharacterTooltips(".characterhelp"),e.f.checkInterface("keyInput",e.templates.gui.keyInput,e.gui.keyInput)},e.gui.keyInput.initFromCharacterState=function(){e.d.characters.forEach(function(e,a){if("spin"===e.ControlType){var r=t("#"+e.Character+".statespinner"),i=t("#clone-"+e.Character+".statespinner"),n=e.stateSet?e.userInput:"";r.spinner("value",e.userInput),i.spinner("value",n)}else{r=t("#"+e.Character+".stateselect"),i=t("#clone-"+e.Character+".stateselect");if(e.stateSet)var s=e.userInput.map(function(t){return e.CharacterStateValues[t]});else s=[];r.val(s).pqSelect("refreshData"),i.val(s).pqSelect("refreshData")}})},e.gui.keyInput.initStateFromParams=function(e){this.initFromCharacterState(),t("#tombioKeyInputTabs").tabs("option","active",e.grp),t("[name='charvisibility']").removeProp("checked").filter('[value="'+e.cvis+'"]').prop("checked",!0),t("[name='charvisibility']").checkboxradio("refresh"),a()},e.gui.keyInput.setParamsFromState=function(e){return e.push("grp="+t("#tombioKeyInputTabs").tabs("option","active")),e.push("cvis="+t("input[name=charvisibility]:checked").val()),e}}(jQuery,this.tombiovis);