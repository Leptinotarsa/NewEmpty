!function(e,t){"use strict";function i(){var i=!1;t.d.groupedCharacters.groups.forEach(function(n,o){var a="";t.d.groupedCharacters[n].forEach(function(e){if(e.stateSet){if(i=!0,a||(a+='<ul style="padding-left: 25px; margin: 0">'),a+="<li>",a+=e.Label+": ","text"==e.ValueType||"ordinal"==e.ValueType||"ordinalcircular"==e.ValueType){var t="";e.userInput.forEach(function(i){t&&(t+=" <i>or</i> "),t+='<span class="tombioOnsKiGroupSummaryValue">'+e.CharacterStateValues[i]+"</span>"})}else if("numeric"==e.ValueType)t='<span class="tombioOnsKiGroupSummaryValue">'+e.userInput+"</span>";a+=t,a+="</li>"}}),a&&(a+="</ul>"),e('.tombioOnsKiGroupSummary[data-group="'+n+'"]').html(a)}),i?e("#tombioOnsKiReset").show():e("#tombioOnsKiReset").hide()}function n(e){return e.substr(12)}function o(e,i){var n="";if(n+=void 0!==i?e.CharacterStates[i].StateHelpShort?e.CharacterStates[i].StateHelpShort:e.CharacterStates[i].StateHelp:e.HelpShort?e.HelpShort:e.Help,void 0!==i)var o=e.CharacterStates[i].StateHelpShort&&e.CharacterStates[i].StateHelp||t.f.getCharacterImages(e.Character,e.CharacterStateValues[i],"full").length>0;else o=t.f.stateValueHelpPresent(e.Character)||t.f.getCharacterImages(e.Character,null,"full").length>0;return o&&(n&&(n+=" "),n+='<a href="" onclick="tombiovis.gui.keyInputOnsenUi.fn.showHelp(event, \''+e.Character+"')\">More help</a>"),n||void 0!==i||("numeric"==e.ValueType?n+="Enter an appropriate value below.":n+="Select an appropriate value below."),n}function a(e,i){var n=t.d.oCharacters[e];if(("text"==n.ValueType||"ordinal"==n.ValueType||"ordinalcircular"==n.ValueType)&&i.querySelector("ons-checkbox").checked||"numeric"==n.ValueType&&""!=i.querySelector("ons-input").value)var o=!0;else o=!1;return o}t.gui.keyInputOnsenUi={width:250,otherState:{keys:[]},fn:{}},t.gui.keyInputOnsenUi.init=function(a){var s=e("<div>").attr("id","tombioKeyinputOnsenUi").appendTo(a),r="";if(t.d.groupedCharacters.groups.length>1)var u="tombioOnsKiGroupsTemplate";else u="tombioOnsKiGroup-None-template";r+='<ons-navigator swipeable id="tombioOnsKiNavigator" page="'+u+'"></ons-navigator>',r+='<template id="tombioOnsKiGroupsTemplate">',r+='<ons-page id="tombioOnsKiGroups">',r+='<ons-fab id="tombioOnsKiReset" position="bottom right" ripple="true" modifier="mini" style="display: none">',r+='<ons-icon icon="md-replay" onclick="tombiovis.gui.keyInputOnsenUi.fn.clearInput()"></ons-icon>',r+="</ons-fab>",r+="<ons-list>",t.d.groupedCharacters.groups.forEach(function(e,i){t.d.groupedCharacters.groups.length>1&&(r+="<ons-list-item expandable tappable onclick=\"tombiovis.gui.keyInputOnsenUi.fn.displayGroupControls('"+e+"')\">",r+='<div class="center">',r+='<span class="list-item__title">'+e+"</span>",r+='<span class="tombioOnsKiGroupSummary tombioOnsKiShortHelp" data-group="'+e+'"></span>',r+="</div>",r+="</ons-list-item>")}),r+="</ons-list> ",r+="</ons-page>",r+="</template>",t.d.groupedCharacters.groups.forEach(function(e,i){r+='<template id="tombioOnsKiGroup-'+e.replace(" ","")+'-template">',r+='<ons-page id="tombioOnsKiGroup-'+e.replace(" ","")+'">',t.d.groupedCharacters[e].forEach(function(e){t.d.groupedCharacters.groups.length>1&&(r+='<ons-toolbar modifier="noshadow">',r+='<div class="left">',r+="<ons-back-button></ons-back-button>",r+="</div>",r+='<div class="center">back to overview</div>',r+="</ons-toolbar>"),"text"==e.ValueType||"ordinal"==e.ValueType||"ordinalcircular"==e.ValueType?r+=function(e){var t="";return t+="<ons-list>",t+='<ons-list-item tappable class="tombioKiOuiCharcterListItem" id="tombioKiOui-'+e.Character+'" data-shown="false" expandable>',t+='<div class="tombioKiOuiCharcterListItemText deselected middle">'+e.Label+"</div>",t+='<div class="expandable-content tombioOnsKiShortHelp"  onclick="tombiovis.gui.keyInputOnsenUi.fn.toggleExpansion(event, \''+e.Character+"')\">"+o(e)+"</div>",t+="</ons-list-item>",t+='<div id="tombioKiOui-'+e.Character+'-stateItems">',e.CharacterStateValues.forEach(function(i,n){t+='<ons-list-item id="tombioKiOui-'+e.Character+"-"+n+'" style="display: none" >',t+='<div class="middle" onclick="tombiovis.gui.keyInputOnsenUi.fn.toggleExpansion(event, \''+e.Character+"')\">"+i+"</div>",t+='<div class="left">',t+="<ons-checkbox onclick=\"tombiovis.gui.keyInputOnsenUi.fn.checkboxClicked(event, '"+e.Character+"', '"+n+"')\"></ons-checkbox>",t+="</div>",t+="</ons-list-item>"}),t+="</div>",t+="</ons-list>"}(e):"numeric"==e.ValueType&&(r+=function(e){var t="";t+="<ons-list>",t+='<ons-list-item class="tombioKiOuiCharcterListItem" id="tombioKiOui-'+e.Character+'" expandable data-shown="false">',t+='<div class="tombioKiOuiCharcterListItemText deselected middle">'+e.Label+"</div>",t+='<div class="expandable-content tombioOnsKiShortHelp">'+o(e)+"</div>",t+="</ons-list-item>",t+='<div id="tombioKiOui-'+e.Character+'-stateItems">',t+='<ons-list-item style="display: none">',t+='<div class="middle">',t+='<ons-input style="width: 90%" modifier="underbar" placeholder="Enter numeric value" type="number"',t+=" onchange=\"tombiovis.gui.keyInputOnsenUi.fn.numericChanged('"+e.Character+"')\"",t+=" onkeyup=\"tombiovis.gui.keyInputOnsenUi.fn.numericChanged('"+e.Character+"')\" > ",t+="</ons-input>";var i=e.Params.split(","),n=Number(i[0]),a=Number(i[1]),s=Number(i[2]);return t+='<ons-range style="width: 90%; margin-top: 10px" value="0" min="'+n+'" max="'+a+'" step="'+s+'"',t+=" onchange=\"tombiovis.gui.keyInputOnsenUi.fn.numericRangeChanged('"+e.Character+"')\" > ",t+="</ons-range>",t+="</div>",t+='<div class="right">',t+='<ons-icon icon="md-close-circle" size="25px" style="color: #1e88e5"',t+=" onclick=\"tombiovis.gui.keyInputOnsenUi.fn.numericClear('"+e.Character+"')\" > ",t+="</ons-icon>",t+="</div>",t+="</ons-list-item>",t+="</div>",t+="</ons-list>"}(e))}),r+="</ons-page>",r+="</template>"}),s.html(r),t.gui.keyInputOnsenUi.divSel="#tombioKeyinputOnsenUi",t.f.checkInterface("keyInputOnsenUi",t.templates.gui.keyInput,t.gui.keyInputOnsenUi),document.addEventListener("listAnimated",function(i){var o=e(i.detail.listItem).attr("id");if(o){var a=n(o);t.gui.keyInputOnsenUi.fn.displaySelect(a,i.detail.action)}}),document.addEventListener("init",function(i){var o=i.target;o.id.startsWith("tombioOnsKiGroup-")&&e("#"+o.id+" .tombioKiOuiCharcterListItem").each(function(){var i=n(e(this).attr("id"));t.d.oCharacters[i].stateSet&&(console.log(i,t.d.oCharacters[i].ValueType),"text"==t.d.oCharacters[i].ValueType||"ordinal"==t.d.oCharacters[i].ValueType||"ordinalcircular"==t.d.oCharacters[i].ValueType?t.d.oCharacters[i].userInput.forEach(function(t){e("#tombioKiOui-"+i+"-"+t+" ons-checkbox")[0].checked=!0}):"numeric"==t.d.oCharacters[i].ValueType&&(console.log("seting numeric ",t.d.oCharacters[i].userInput),e("#tombioKiOui-"+i+"-stateItems ons-input")[0].value=t.d.oCharacters[i].userInput),t.gui.keyInputOnsenUi.fn.displaySelect(i,"hide"))})}),document.addEventListener("show",function(e){"tombioOnsKiGroups"==e.target.id&&i()})},t.gui.keyInputOnsenUi.initFromCharacterState=function(){},t.gui.keyInputOnsenUi.initStateFromParams=function(e){i()},t.gui.keyInputOnsenUi.setParamsFromState=function(e){return e},t.gui.keyInputOnsenUi.fn.displayGroupControls=function(e){var t="tombioOnsKiGroup-"+e.replace(" ","")+"-template";document.querySelector("#tombioOnsKiNavigator").pushPage(t)},t.gui.keyInputOnsenUi.fn.displaySelect=function(t,i){var n="#tombioKiOui-"+t,o=n+"-stateItems > ons-list-item";"show"==i?(e(n).attr("data-shown","true"),e(o+" ons-range").show(),e(o).slideDown(200)):(e(n).attr("data-shown","false"),e(o).each(function(){a(t,this)?e(this).slideDown(200):e(this).slideUp(200),e(o+" ons-range").slideUp(200)})),e(n+" .tombioKiOuiCharcterListItemText").removeClass("selected deselected");var s=!1;e(o).each(function(){a(t,this)&&(s=!0)}),s||"show"==i?(e(n+" .tombioKiOuiCharcterListItemText").removeClass("deselected"),e(n+" .tombioKiOuiCharcterListItemText").addClass("selected")):(e(n+" .tombioKiOuiCharcterListItemText").removeClass("selected"),e(n+" .tombioKiOuiCharcterListItemText").addClass("deselected"))},t.gui.keyInputOnsenUi.fn.checkboxClicked=function(i,n,o){"true"==e("#tombioKiOui-"+n).attr("data-shown")&&document.querySelector("#tombioKiOui-"+n).hideExpansion(),document.querySelector("#tombioKiOui-"+n+"-"+o).hideExpansion();var a="#tombioKiOui-"+n+"-stateItems > ons-list-item";"single"==t.d.oCharacters[n].ControlType&&(document.querySelector("#tombioKiOui-"+n+"-"+o+" ons-checkbox").checked&&e(a).each(function(e){e!=o&&(this.querySelector("ons-checkbox").checked=!1)}));t.gui.keyInputOnsenUi.fn.displaySelect(n,"hide");var s=[];e(a).each(function(e){this.querySelector("ons-checkbox").checked&&s.push(e)}),s.length>0?(t.d.oCharacters[n].userInput=s,t.d.oCharacters[n].stateSet=!0):(t.d.oCharacters[n].userInput=null,t.d.oCharacters[n].stateSet=!1),t.f.refreshVisualisation()},t.gui.keyInputOnsenUi.fn.toggleExpansion=function(t,i){"false"==e("#tombioKiOui-"+i).attr("data-shown")?(console.log("showing"),document.querySelector("#tombioKiOui-"+i).showExpansion(function(){console.log("shown")})):document.querySelector("#tombioKiOui-"+i).hideExpansion()},t.gui.keyInputOnsenUi.fn.numericChanged=function(i){var n=document.querySelector("#tombioKiOui-"+i+"-stateItems ons-input").value;"false"==e("#tombioKiOui-"+i).attr("data-shown")&&""==n&&document.querySelector("#tombioKiOui-"+i).hideExpansion();var o=""==n?0:n;document.querySelector("#tombioKiOui-"+i+"-stateItems ons-range").value=o,""!=n?(t.d.oCharacters[i].userInput=n,t.d.oCharacters[i].stateSet=!0):(t.d.oCharacters[i].userInput=null,t.d.oCharacters[i].stateSet=!1),t.f.refreshVisualisation()},t.gui.keyInputOnsenUi.fn.numericRangeChanged=function(e){var i=document.querySelector("#tombioKiOui-"+e+"-stateItems ons-range").value;document.querySelector("#tombioKiOui-"+e+"-stateItems ons-input").value=i,t.gui.keyInputOnsenUi.fn.numericChanged(e)},t.gui.keyInputOnsenUi.fn.numericClear=function(e){document.querySelector("#tombioKiOui-"+e+"-stateItems ons-input").value="",t.gui.keyInputOnsenUi.fn.numericChanged(e)},t.gui.keyInputOnsenUi.fn.clearInput=function(e){t.d.characters.forEach(function(e){e.userInput=null,e.stateSet=!1}),i(),t.f.refreshVisualisation()},t.gui.keyInputOnsenUi.fn.showHelp=function(e,i){e.preventDefault(),e.stopPropagation(),t.gui.main.dialog("Character help & info",t.f.getFullCharacterHelp(i))}}(jQuery,this.tombiovis);